[[backup]]
==  Backing Up and Restoring {nxrm}
{inall}

TBD

[[backup-introduction]]
=== Introduction

TBD

[[backup-configuration]]
=== Backup Plan

TBD
////
Checklist, self-repair tasks - TBD
////


[[backup-requirements]]
=== Requirements for Backing Up {nxrm}

TBD


[[backup-preparation]]
=== Preparing a Backup for {nxrm}

TBD
////
Formalize: Before you execute a backup of your OrientDB, select a backup tool of your preference to
back your content, i.e. accesslog, components, system configuration, and security
////

[[backup-task]]
=== Configuring and Running a Database Backup Task

{nxrm} allows you to back up your underlying databases for both a single-node deployment or a cluster of
multiple nodes, when activating <<high-availability,high availability>>.

To configure and run a new task for database backup, review the steps in the Configuration chapter. The form
for this task includes an additional field called 'Backup location', which requires you to enter a file
where you want to store backup data, shown in <<fig-backup-task>>. In this field you add an absolute or
relative path to store your databases. To configure the task to export backup data to a relative location
store it in your data directory, e.g. `$data-dir/nexus3`.

////
Note: removed the anchor/macro referencing tasks due to missing steps addressed in another ticket (bug)  
////

[[fig-backup-task]]
.Manual Database Backup Task with Directory Location 
image::figs/web/backup-task.png[scale=50]

When the task runs it exports backup data to the path specified in the 'Backup location' field. The directory
you input will contain +.bak+ files of the following databases:

Access log:: login and usage information among repository manager users 
Analytics:: event data and overall repository manager usage
Auditing:: a record of repository manager configuration changes as well as asset or component additions and
removals
Component:: all related data that make up components within the repository manager 
Configuration:: general adminstrative configurations such as scheduled tasks, email server configuration, etc.
Security:: all user and access rights management content

All backup files are presented in the timestamp format based on the time the task was started.

[[backup-node]]
=== Backing up a Single Node in {nxrm}

TBD
////
Distinguish single node backup from an backup for HA
////


[[backup-ha]]
=== Backing up {nxrm} in an HA Environment

TBD

[[backup-retrieve]]
=== Restoring a Database Backup

////
IMPORTANT:: The restoration process should be executed on a single node.  All nodes in an high availability cluster
should be stopped prior to restoration.
////

You can restore the exported database files to their full state after the backup is complete. You will need to access
the relative location you created in `$data-dir/nexus3`. For example, if configuring the task to store your `.bak`
files in a relative location called `backup`, follow these steps:

1. If {nxrm} won't start, install a fresh copy of the repository manager; it must be the same version where the
`.bak` files were created.
2. Stop the repository manager.
3. Copy the relative path file to `$data-dir/nexus3`
4. Remove the existing database folder (`db`) from `$data-dir/nexus3/db` if they exist. The restoration won't
overwrite any existing data.
5. Restart {nxrm}.

To verify the restoration, check the logs for a message that says "database config restored", which is logged at the
`INFO` level.

NOTE:: If the `Component` database is restored, the corresponding blobstores containing components must also be
restored.
